<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Restablecer Contraseña</title>
  <link rel="stylesheet" href="css/auth.css">
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="card-header">
        <h1>Nueva contraseña</h1>
      </div>
      <div class="card-body">
        <div id="msg" class="message"></div>
        <form id="formReset">
          <div class="form-group">
            <label for="pass">Nueva contraseña</label>
            <input id="pass" type="password" minlength="6" required placeholder="••••••••">
          </div>
          <div class="form-group">
            <label for="pass2">Confirmar contraseña</label>
            <input id="pass2" type="password" minlength="6" required placeholder="••••••••">
          </div>
          <button class="btn btn-primary" type="submit">Restablecer</button>
        </form>
        <div class="helper"><a href="/login.html">Volver al login</a></div>
      </div>
    </div>
  </div>

  <script>
    const msg = document.getElementById('msg');
    function show(type, text){ msg.className = `message ${type}`; msg.textContent = text; msg.style.display = 'block'; }

    const params = new URLSearchParams(window.location.search);
    const token = params.get('token');

    document.getElementById('formReset').addEventListener('submit', async (e) => {
      e.preventDefault();
      const pass = document.getElementById('pass').value;
      const pass2 = document.getElementById('pass2').value;
      if(pass !== pass2){ show('error','Las contraseñas no coinciden'); return; }
      if(!token){ show('error','Enlace inválido o expirado'); return; }
      try {
        const res = await fetch('/api/reset-password', { method:'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ token, contrasenia: pass }) });
        const data = await res.json();
        if(res.ok){ show('success','Contraseña restablecida. Redirigiendo...'); setTimeout(()=>{ window.location.href = '/login.html'; }, 1500); }
        else { show('error', data.message || 'No se pudo restablecer'); }
      } catch(err){ show('error','Error de conexión'); }
    });
  </script>
</body>
</html>









